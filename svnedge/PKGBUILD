# Maintainer: Jakob Gruber (jakob gruber kabelnet at)

pkgname=svnedge
pkgver=1.0.0
pkgdesc="Subversion Edge includes a complete software stack of Apache, Subversion and ViewVC as well as a powerful web-based user interface for managing the server."
pkgrel=1
arch=('i686' 'x86_64')
url="http://www.open.collab.net/go/csvne1_r1a/"
license=('AGPLv3')
install="svnedge.install"

if [ $CARCH == 'x86_64' ]; then
	_pkgarch='x86_64'
	md5sums=('36c013c48b4c9766d5b5c09df3e40473' 'c746c20ea769161b1079ef69b1d59ae2')
	depends=('python' 'svn' 'openjdk6' 'lib32-libidn' 'lib32-libkrb53')
else
	_pkgarch='x86'
	md5sums=('58a657a86b90130419677f094537159c' 'c746c20ea769161b1079ef69b1d59ae2')
	depends=('python' 'svn' 'openjdk6' 'libidn' 'libkrb53')
fi

source=("http://dl.dropbox.com/u/169548/CollabNetSubversionEdge-${pkgver}_linux-${_pkgarch}.tar.gz" "uname.patch")


build() {
  cd $srcdir

  # correctly determine our architecture
  patch -Np1 < $srcdir/uname.patch

  # install into /opt
  mkdir -p $pkgdir/opt/$pkgname/
  cp -r $srcdir/csvn/* \
        $srcdir/csvn/.org.opensolaris,pkg \
	$pkgdir/opt/$pkgname/

  # copy our own python bindings since the shipped bindings do not work with our python
  cd $pkgdir/opt/$pkgname/lib/svn-python
  rm -r $pkgdir/opt/$pkgname/lib/svn-python/*
  ln -s /usr/lib/python2.6/site-packages/svn/
  ln -s /usr/lib/python2.6/site-packages/libsvn/
}
