# Maintainer: schuay <jakob.gruber@gmail.com>

pkgname=svnedge
pkgver=1.3.1
pkgdesc="Subversion Edge includes a complete software stack of Apache, Subversion and ViewVC as well as a powerful web-based user interface for managing the server."
pkgrel=1
arch=('i686' 'x86_64')
url="http://www.open.collab.net/go/csvne1_r1a/"
license=('AGPLv3')
install="svnedge.install"

if [ $CARCH == 'x86_64' ]; then
	_pkgarch='x86_64'
	md5sums=('f6e2bb328da56f4342bd705d909c45e1' 'c746c20ea769161b1079ef69b1d59ae2')
	depends=('python2' 'svn' 'openjdk6' 'lib32-libidn' 'lib32-libkrb53')
else
	_pkgarch='x86'
	md5sums=('86955190948cdb686747b69c72f0f2e2' 'c746c20ea769161b1079ef69b1d59ae2')
	depends=('python2' 'svn' 'openjdk6' 'libidn' 'libkrb53')
fi

source=("http://dl.dropbox.com/u/169548/CollabNetSubversionEdge-${pkgver}_linux-${_pkgarch}.tar.gz" "uname.patch")


build() {
  cd ${srcdir}

  # correctly determine our architecture
  patch -Np1 < ${srcdir}/uname.patch

  # install into /opt
  mkdir -p ${pkgdir}/opt/${pkgname}/
  cp -r ${srcdir}/csvn/* \
        ${srcdir}/csvn/.org.opensolaris,pkg \
	${pkgdir}/opt/${pkgname}/

  # copy our own python bindings since the shipped bindings do not work with our python
  cd ${pkgdir}/opt/${pkgname}/lib/svn-python
  rm -r ${pkgdir}/opt/${pkgname}/lib/svn-python/*
  ln -s /usr/lib/python2.7/site-packages/svn/
  ln -s /usr/lib/python2.7/site-packages/libsvn/

}
